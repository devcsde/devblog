{"version":3,"sources":["../app.js"],"names":["express","require","app","bodyParser","methodOverride","expressSanitizer","mongoose","passport","LocalStrategy","session","MongoStore","User","IP","process","env","port","PORT","config","commentRoutes","blogRoutes","indexRoutes","Promise","global","connect","DB_DEV_URI","useMongoClient","use","urlencoded","extended","set","static","__dirname","secret","SECRET","resave","saveUninitialized","store","mongooseConnection","connection","cookie","maxAge","initialize","authenticate","serializeUser","deserializeUser","req","res","next","locals","currentUser","user","status","render","listen","console","log"],"mappings":";;AAAA,IAAMA,UAAUC,QAAQ,SAAR,CAAhB;AAAA,IACEC,MAAMF,SADR;AAAA,IAEEG,aAAaF,QAAQ,aAAR,CAFf;AAAA,IAGEG,iBAAiBH,QAAQ,iBAAR,CAHnB;AAAA,IAIEI,mBAAmBJ,QAAQ,mBAAR,CAJrB;AAAA,IAKEK,WAAWL,QAAQ,UAAR,CALb;AAAA,IAMEM,WAAWN,QAAQ,UAAR,CANb;AAAA,IAOEO,gBAAgBP,QAAQ,gBAAR,CAPlB;AAAA,IAQEQ,UAAUR,QAAQ,iBAAR,CARZ;AAAA,IASES,aAAaT,QAAQ,eAAR,EAAyBQ,OAAzB,CATf;AAAA,IAUEE,OAAOV,QAAQ,eAAR,CAVT;AAAA,IAWEW,KAAKC,QAAQC,GAAR,CAAYF,EAAZ,IAAkB,WAXzB;AAAA,IAYEG,OAAOF,QAAQC,GAAR,CAAYE,IAAZ,IAAoB,IAZ7B;;AAcAf,QAAQ,QAAR,EAAkBgB,MAAlB;;AAEA,IAAMC,gBAAgBjB,QAAQ,mBAAR,CAAtB;AACA,IAAMkB,aAAalB,QAAQ,gBAAR,CAAnB;AACA,IAAMmB,cAAcnB,QAAQ,gBAAR,CAApB;;AAEAK,SAASe,OAAT,GAAmBC,OAAOD,OAA1B;AACAf,SAASiB,OAAT,CAAiBV,QAAQC,GAAR,CAAYU,UAA7B,EAAyC,EAACC,gBAAgB,IAAjB,EAAzC;AACAvB,IAAIwB,GAAJ,CAAQvB,WAAWwB,UAAX,CAAsB,EAACC,UAAU,IAAX,EAAtB,CAAR;AACA1B,IAAIwB,GAAJ,CAAQrB,kBAAR;AACAH,IAAIwB,GAAJ,CAAQtB,eAAe,SAAf,CAAR;AACAF,IAAI2B,GAAJ,CAAQ,aAAR,EAAuB,KAAvB;AACA3B,IAAIwB,GAAJ,CAAQ1B,QAAQ8B,MAAR,CAAeC,YAAY,SAA3B,CAAR;;AAEA;AACA7B,IAAIwB,GAAJ,CAAQjB,QAAQ;AACduB,UAAQnB,QAAQC,GAAR,CAAYmB,MADN;AAEdC,UAAQ,KAFM;AAGdC,qBAAmB,KAHL;AAIdC,SAAO,IAAI1B,UAAJ,CAAe,EAAC2B,oBAAoB/B,SAASgC,UAA9B,EAAf,CAJO;AAKdC,UAAQ,EAACC,QAAQ,MAAM,EAAN,GAAW,IAApB,CAA0B;AAA1B,GALM,EAAR,CAAR;AAOAtC,IAAIwB,GAAJ,CAAQnB,SAASkC,UAAT,EAAR;AACAvC,IAAIwB,GAAJ,CAAQnB,SAASE,OAAT,EAAR;AACAF,SAASmB,GAAT,CAAa,IAAIlB,aAAJ,CAAkBG,KAAK+B,YAAL,EAAlB,CAAb;AACAnC,SAASoC,aAAT,CAAuBhC,KAAKgC,aAAL,EAAvB;AACApC,SAASqC,eAAT,CAAyBjC,KAAKiC,eAAL,EAAzB;;AAEA;AACA;AACA1C,IAAIwB,GAAJ,CAAQ,UAACmB,GAAD,EAAMC,GAAN,EAAWC,IAAX,EAAoB;AAC1BD,MAAIE,MAAJ,CAAWC,WAAX,GAAyBJ,IAAIK,IAA7B;AACAH;AACD,CAHD;;AAKA7C,IAAIwB,GAAJ,CAAQN,WAAR;AACAlB,IAAIwB,GAAJ,CAAQ,qBAAR,EAA+BR,aAA/B;AACAhB,IAAIwB,GAAJ,CAAQ,QAAR,EAAkBP,UAAlB;;AAEA;AACAjB,IAAIwB,GAAJ,CAAQ,UAAUmB,GAAV,EAAeC,GAAf,EAAoBC,IAApB,EAA0B;AAChCD,MAAIK,MAAJ,CAAW,GAAX;AACAL,MAAIM,MAAJ,CAAW,KAAX;AACA;AACD,CAJD;;AAMAlD,IAAImD,MAAJ,CAAWtC,IAAX,EAAiBH,EAAjB,EAAqB,YAAM;AACzB0C,UAAQC,GAAR,6BAAsC3C,EAAtC,SAA4CG,IAA5C;AACD,CAFD","file":"app.js","sourcesContent":["const express = require(\"express\"),\n  app = express(),\n  bodyParser = require(\"body-parser\"),\n  methodOverride = require(\"method-override\"),\n  expressSanitizer = require(\"express-sanitizer\"),\n  mongoose = require(\"mongoose\"),\n  passport = require(\"passport\"),\n  LocalStrategy = require(\"passport-local\"),\n  session = require(\"express-session\"),\n  MongoStore = require(\"connect-mongo\")(session),\n  User = require(\"./models/user\"),\n  IP = process.env.IP || \"localhost\",\n  port = process.env.PORT || 3000;\n\nrequire('dotenv').config();\n\nconst commentRoutes = require(\"./routes/comments\");\nconst blogRoutes = require(\"./routes/blogs\");\nconst indexRoutes = require(\"./routes/index\");\n\nmongoose.Promise = global.Promise;\nmongoose.connect(process.env.DB_DEV_URI, {useMongoClient: true});\napp.use(bodyParser.urlencoded({extended: true}));\napp.use(expressSanitizer());\napp.use(methodOverride(\"_method\"));\napp.set(\"view engine\", \"ejs\");\napp.use(express.static(__dirname + \"/public\"));\n\n// PASSPORT CONFIGURATION\napp.use(session({\n  secret: process.env.SECRET,\n  resave: false,\n  saveUninitialized: false,\n  store: new MongoStore({mongooseConnection: mongoose.connection}),\n  cookie: {maxAge: 180 * 60 * 1000} // Timeout 180 mins\n}));\napp.use(passport.initialize());\napp.use(passport.session());\npassport.use(new LocalStrategy(User.authenticate()));\npassport.serializeUser(User.serializeUser());\npassport.deserializeUser(User.deserializeUser());\n\n// this middleware provides in every route req.user\n// AND in every view currentUser\napp.use((req, res, next) => {\n  res.locals.currentUser = req.user;\n  next();\n});\n\napp.use(indexRoutes);\napp.use(\"/blogs/:id/comments\", commentRoutes);\napp.use(\"/blogs\", blogRoutes);\n\n// Handle 404 - Keep this as a last route\napp.use(function (req, res, next) {\n  res.status(400);\n  res.render(\"404\");\n  //res.send('404: File Not Found');\n});\n\napp.listen(port, IP, () => {\n  console.log(`Server started at port ${IP}:${port}`)\n});"]}